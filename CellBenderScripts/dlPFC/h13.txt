#!/bin/bash -l

#SBATCH -N 1 --ntasks-per-node=6 --partition=gpu
#SBATCH --gres=gpu:1
#SBATCH --job-name="h13_rem"
#SBATCH --output=/home/dennis00/Yi_lab/CellBender_scripts/slurm-archive/%j_dlPFC_h13_rem.out

module load cuda/11.7

cd $SLURM_SUBMIT_DIR

conda activate cellbender

cd /home/dennis00/Yi_lab/MarkerPaper/CellBenderScripts/dlPFC/h13/

REPS="HSB106_1 HSB106_3 HSB628_1 HSB628_3 HSB189_2 HSB340_1"

for p in $REPS
do
	folder_name="${p}"
	echo $folder_name
		  cellbender remove-background \
                  	--input "/home/dennis00/Yi_lab/raw_h5_data/Ma_h5/${folder_name}.h5" \
	                --output "/home/dennis00/Yi_lab/MarkerPaper/CellBender_ProcessedDataMarkerPaper/dlPFC/${folder_name}.h5" \
                  	--cuda \
                   	--expected-cells 25000 \
                  	--total-droplets-included 40000 \
                 	--low-count-threshold 15 \
                  	--learning-rate 1e-4 \
                  	--fpr 0.01 \
                 	--epochs 150
done

echo cellbender_Ma_human
echo "SLURM Job ID        : ${SLURM_JOB_ID}"
